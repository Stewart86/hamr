## Codebase Patterns
- TUI/GTK/daemon write debug logs to `/tmp` with symlink to latest log.
- **IMPORTANT**: CLI commands use `hamr` binary only, NOT `hamr-daemon`, `hamr-gtk`, `hamr-tui`, etc.
  - Correct: `hamr query "text"`, `hamr index`, `hamr test shell "ls"`
  - Wrong: `hamr-daemon query "text"`, `hamr-cli query "text"`
  - The `hamr` binary is the user-facing CLI; other binaries are internal components
- Configuration is JSON-based with camelCase field names and sensible defaults.
- Action bar hints provide customizable plugin shortcuts with prefix/icon/label/plugin mapping.

## [docs-install-refresh] - DONE
- What: Updated installation guide and README for Rust/GTK implementation, removing QML/Quickshell references and adding GTK4 dependencies
- Files: docs/getting-started/installation.md, README.md, docs/index.md
- Learned: The project has transitioned from QML/Quickshell to Rust/GTK4, requiring updated dependency information and command examples
---

## [docs-config-refresh] - DONE
- What: Refreshed configuration guide to match current Rust/GTK schema, removing QML references and updating all config options
- Files: docs/getting-started/configuration.md
- Learned: Current config uses camelCase JSON with search prefixes, action bar hints, app config for terminal/fileManager/browser, and comprehensive plugin ranking system
- **FIXED**: Corrected CLI command references to use `hamr` instead of `hamr-daemon`/`hamr-gtk`/`hamr-cli`
---

## [docs-landing-migration] - DONE
- What: Updated landing page with migration notice for Rust/GTK4 rewrite and cleaned up stale MkDocs navigation sections
- Files: docs/index.md, mkdocs.yml
- Learned: Added migration notice linking to legacy-qml branch, fixed CLI command references from hamr-gtk/hamr-cli to hamr, removed stale plugin documentation sections from navigation
---

## [Fix]: Correct CLI command references to use `hamr` instead of `hamr-daemon`/`hamr-gtk`/`hamr-cli` - DONE
- What: Fixed incorrect CLI command references in README.md Quick Start section and installation.md compositor examples to use the correct `hamr` binary
- Files: README.md (lines 94-98, 107-108), docs/getting-started/installation.md (lines 115-116, 136)
- Learned: User-facing commands should always use `hamr` binary; internal component names are only appropriate for architecture docs and log paths
---

## [installer-preserve-user-data] - DONE
- What: Added `--reset-user-data` flag to install.sh to preserve user config/plugins by default, with automatic backup when reset is requested
- Files: install.sh
- Learned: The installer previously had destructive behavior that overwrote user plugins/config. Now it preserves user data by default and only resets when explicitly requested with a timestamped backup.
---

## [installer-flags-docs] - DONE
- What: Added installer flags documentation table to README.md and docs/getting-started/installation.md with --check, --yes, and --reset-user-data flags
- Files: README.md (lines 33-38), docs/getting-started/installation.md (lines 88-93)
- Learned: The installer script supports dry-run mode (--check), non-interactive mode (--yes), and user data reset (--reset-user-data) with automatic backup
---

## [compositor-matrix] - DONE
- What: Added compositor support matrix table and layer-shell package names to README and installation docs
- Files: README.md, docs/getting-started/installation.md
- Learned: Created comprehensive support matrix showing Hyprland/Niri/Sway/KDE Wayland as supported, GNOME/X11 as not supported, plus distro-specific package names for layer-shell dependencies
---

## [troubleshooting-table] - DONE
- What: Created comprehensive troubleshooting guide with quick diagnosis table (8 issues) and detailed sections for daemon, plugin, display, and performance issues
- Files: docs/getting-started/troubleshooting.md (new), mkdocs.yml (added nav entry)
- Learned: mkdocs-material requires `pipx install mkdocs-material --include-deps && pipx inject mkdocs-material mike` for proper installation
---

## [layer-shell-distro-packages] - DONE
- What: Verified layer-shell package names already documented - table exists in installation.md (lines 124-133) with Arch/Fedora/Ubuntu/openSUSE/Gentoo; README has install commands for all three required distros
- Files: docs/getting-started/installation.md, README.md (no changes needed - already complete)
- Learned: This task was already completed as part of [compositor-matrix]; the acceptance criteria (Arch/Fedora/Ubuntu package names) was satisfied in that earlier task
---

## [generate-plugin-checksums] - DONE
- What: Created scripts/generate-plugin-checksums.sh that generates SHA256 checksums for all plugin files into plugins/checksums.json
- Files: scripts/generate-plugin-checksums.sh (new), plugins/checksums.json (generated)
- Learned: Plugin structure is consistent: each plugin has manifest.json and handler.py; some have additional data files (emojis.tsv, launch-webapp). Script supports --verify mode for verification.
---

## [checksum-in-release-workflow] - DONE
- What: Added plugin checksum generation step to release workflow for both x86_64 and aarch64 builds
- Files: .github/workflows/release.yml
- Learned: The checksum script runs after build and before archive creation, so checksums.json is included in the plugins directory within the release tarball. For aarch64, the script runs outside Docker since plugins are the same on all architectures.
---

## [runtime-checksum-verification] - DONE
- What: Added runtime checksum verification in daemon that logs warnings when plugin files are modified
- Files: crates/hamr-core/src/plugin/checksum.rs (new), crates/hamr-core/src/plugin/mod.rs, crates/hamr-core/Cargo.toml (added sha2, hex deps), crates/hamr-daemon/src/server.rs
- Learned: Checksum verification loads checksums.json from builtin_plugins dir at daemon startup. Each plugin's files are verified with SHA256 during discovery. Modified files trigger warnings, unknown plugins (user-installed) log debug messages, verified plugins log debug success. Added 8 unit tests for checksum module covering load/verify/hash scenarios.
---

## [hamr-plugins-audit] - DONE
- What: Added `hamr plugins audit` CLI command that lists plugins with verified/modified/unknown status
- Files: crates/hamr-cli/Cargo.toml (added hamr-core dep), crates/hamr-cli/src/main.rs
- Learned: Reused ChecksumsData and PluginVerifyStatus from hamr-core::plugin module (already exported). The command scans both builtin_plugins and user_plugins directories, skipping sdk and __pycache__ dirs. Shows summary with VERIFIED/MODIFIED/UNKNOWN counts and warnings for modified plugins.
---

## [security-md-plugin-trust-model] - DONE
- What: Updated SECURITY.md with plugin trust model documentation including checksum verification, audit command usage, and third-party plugin guidance
- Files: SECURITY.md
- Learned: Updated outdated QML/Quickshell reference to Rust/GTK4. Added comprehensive Plugin Trust Model section with verification status table, `hamr plugins audit` example output, and guidance on regenerating checksums. Skipped `python -m compileall plugins` check since SDK/plugins were untouched.
---

## [sdk-readme-quickstart] - DONE
- What: Created plugins/sdk/README.md with comprehensive quick start guide, manifest template, handler examples (stdio and socket), response type documentation, and testing workflow
- Files: plugins/sdk/README.md (new)
- Learned: Plugin SDK supports both stdio (stateless JSON stdin/stdout) and socket (HamrPlugin class with decorators) communication models. Testing workflow uses `cargo run -p hamr-daemon` with log tailing at `/tmp/hamr-daemon.log`. SDK provides response builders like `plugin.results()`, `plugin.copy_and_close()`, etc. Skipped `python -m compileall plugins` since only markdown was added.
---

## [pyproject-python-version] - DONE
- What: Updated pyproject.toml requires-python from >=3.13 to >=3.10 (minimum based on SDK's use of union type syntax `str | None`); also fixed placeholder description
- Files: pyproject.toml
- Learned: SDK uses `str | None` union syntax which requires Python 3.10+, not 3.9 as originally specified. Python 3.10 is available on Ubuntu 22.04 LTS and newer distros. Skipped `python -m compileall plugins` since only pyproject.toml was modified.
---

## [contrib-plugin-testing] - DONE
- What: Added comprehensive plugin testing checklist to CONTRIBUTING.md with pre-flight checks, manual testing workflow, and verification checklist
- Files: CONTRIBUTING.md
- Learned: Also updated outdated QML code style section to Rust, and fixed bug report log path references (was `qs -c hamr`, now `/tmp/hamr-daemon.log`). Skipped `python -m compileall plugins` since only markdown was modified.
---

## [release-check-script] - DONE
- What: Created scripts/release-check.sh that runs fmt/clippy/test/build/mkdocs and exits non-zero on failure
- Files: scripts/release-check.sh (new)
- Learned: Script follows existing pattern from generate-plugin-checksums.sh. Includes --quick mode to skip cargo test, verbose output on failure, summary with pass/fail counts. Also checks plugin checksums if checksums.json exists, and python syntax check if python3 is available.
---
